<div class="grow text-left py-10 space-y-8">
  <section>
    <h1 class="text-4xl font-bold">Verification Attempt #<%= @attempt.id %></h1>
  </section>

  <section class="space-y-6">
    <div class="bg-neutral-800/50 rounded-lg p-6">
      <div class="grid grid-cols-2 gap-6">
        <div>
          <h4 class="text-default-questions font-semibold mb-3">Attempt Details</h4>
          <div class="space-y-2 text-sm">
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">Time (UTC):</span>
              <span class="col-span-2 text-default-answers"><%= @attempt.created_at&.utc&.strftime('%Y-%m-%d %H:%M:%S') %></span>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">Program:</span>
              <span class="col-span-2 text-default-answers"><%= @attempt.program.presence || '—' %></span>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">IDV Record:</span>
              <span class="col-span-2 text-default-answers font-mono text-xs"><%= @attempt.idv_rec.presence || '—' %></span>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">Submit ID:</span>
              <span class="col-span-2 text-default-answers font-mono text-xs"><%= @attempt.submit_id.presence || '—' %></span>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">Full name:</span>
              <span class="col-span-2 text-default-answers"><%= [@attempt.first_name, @attempt.last_name].compact.join(' ').presence || '—' %></span>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">Email:</span>
              <span class="col-span-2 text-default-answers"><%= @attempt.email.presence || '—' %></span>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">IP Address:</span>
              <span class="col-span-2 text-default-answers"><%= @attempt.ip.presence || '—' %></span>
            </div>
          </div>
        </div>
        <div>
          <h4 class="text-default-questions font-semibold mb-3">Verification Status</h4>
          <div class="space-y-2 text-sm">
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">Verified:</span>
              <span class="col-span-2">
                <% if @attempt.verified %>
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded bg-green-300/10 text-green-300">Yes</span>
                <% else %>
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded bg-red-300/10 text-red-300">No</span>
                <% end %>
              </span>
            </div>
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">Status:</span>
              <span class="col-span-2">
                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded bg-neutral-200/10 text-neutral-300"><%= @attempt.verification_status.presence || '—' %></span>
              </span>
            </div>
            <% if @attempt.rejection_reason.present? %>
              <div class="grid grid-cols-3 gap-2">
                <span class="text-default-questions/75">Rejection:</span>
                <span class="col-span-2 text-red-300"><%= @attempt.rejection_reason %></span>
              </div>
            <% end %>
            <div class="grid grid-cols-3 gap-2">
              <span class="text-default-questions/75">YSWS Eligible:</span>
              <span class="col-span-2">
                <% if @attempt.ysws_eligible.nil? %>
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded bg-neutral-200/10 text-neutral-300">—</span>
                <% elsif @attempt.ysws_eligible %>
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded bg-green-300/10 text-green-300">Yes</span>
                <% else %>
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded bg-red-300/10 text-red-300">No</span>
                <% end %>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-neutral-800/50 rounded-lg p-6">
      <h4 class="text-default-questions font-semibold mb-3">Identity Response JSON</h4>
      <% identity_json = (@attempt.identity_response || {}).as_json %>
      <% if identity_json.blank? || identity_json == {} %>
        <div class="text-default-questions/75 text-center py-4">No identity data</div>
      <% else %>
        <pre class="bg-neutral-900 p-4 rounded-md text-xs w-full overflow-x-auto text-neutral-300"><%= JSON.pretty_generate(identity_json) %></pre>
      <% end %>
    </div>
  </section>

  <section class="space-y-4">
    <h2 class="text-3xl font-bold">User Journey Events</h2>
    <% events = UserJourneyEvent.where(verification_attempt_id: @attempt.id).order(:created_at) %>
    <% if events.any? %>
      <div class="bg-neutral-800/50 rounded-lg p-6">
        <div class="space-y-1">
          <% events.each do |e| %>
            <div class="flex items-center space-x-2 text-sm border-b border-neutral-700/50 pb-2 mb-2 last:border-b-0 last:pb-0 last:mb-0">
              <span class="text-default-questions/75 font-mono text-xs min-w-[80px]"><%= e.created_at&.utc&.strftime('%H:%M:%S') %></span>
              <span class="text-default-answers font-medium min-w-[120px]"><%= e.event_type.humanize %></span>
              <span class="text-default-questions/75 text-xs min-w-[80px]"><%= e.program.presence || '—' %></span>
              <span class="text-default-questions/75 text-xs min-w-[100px] font-mono"><%= e.idv_rec.presence&.truncate(15) || '—' %></span>
              <span class="text-default-questions/75 text-xs min-w-[120px]"><%= e.email.presence&.truncate(20) || '—' %></span>
              <span class="text-default-questions/75 text-xs min-w-[80px]"><%= e.request_ip.presence || '—' %></span>
              <% if e.metadata.present? %>
                <pre class="text-xs text-neutral-400 flex-1 overflow-x-auto"><%= e.metadata.to_json %></pre>
              <% else %>
                <span class="text-neutral-400 text-xs flex-1">—</span>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="text-default-questions/75 text-center py-8">No journey events for this attempt.</div>
    <% end %>
  </section>

  <section>
    <%= render "shared/button", type: "secondary", link: admin_verification_attempts_path do %>
      ← Back to all attempts
    <% end %>
  </section>
</div>
